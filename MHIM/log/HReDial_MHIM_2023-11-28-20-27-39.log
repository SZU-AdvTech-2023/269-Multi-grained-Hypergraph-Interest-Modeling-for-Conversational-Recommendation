2023-11-28 20:27:39.987 | INFO     | crslab.config.config:__init__:87 - [Dataset: HReDial tokenized in nltk]
2023-11-28 20:27:39.988 | INFO     | crslab.config.config:__init__:89 - [Model: MHIM]
2023-11-28 20:27:39.988 | INFO     | crslab.config.config:__init__:96 - [Config]
{
    "dataset": "HReDial",
    "tokenize": "nltk",
    "related_truncate": 1024,
    "context_truncate": 256,
    "response_truncate": 30,
    "scale": 1,
    "model": "MHIM",
    "token_emb_dim": 300,
    "kg_emb_dim": 128,
    "num_bases": 8,
    "n_heads": 2,
    "n_layers": 2,
    "ffn_size": 300,
    "dropout": 0.1,
    "attention_dropout": 0.0,
    "relu_dropout": 0.1,
    "learn_positional_embeddings": false,
    "embeddings_scale": true,
    "reduction": false,
    "n_positions": 1024,
    "user_proj_dim": 512,
    "mha_n_heads": 4,
    "pooling": "Mean",
    "extension_strategy": "Adaptive",
    "rec": {
        "epoch": 100,
        "batch_size": 256,
        "early_stop": true,
        "stop_mode": "min",
        "impatience": 2,
        "optimizer": {
            "name": "Adam",
            "lr": 0.001
        }
    },
    "conv": {
        "epoch": 5,
        "batch_size": 128,
        "impatience": 1,
        "optimizer": {
            "name": "Adam",
            "lr": 0.001
        },
        "lr_scheduler": {
            "name": "ReduceLROnPlateau",
            "patience": 3,
            "factor": 0.5
        },
        "gradient_clip": 0.1
    },
    "pretrain": true,
    "pretrain_epoch": 10,
    "gpu": [
        0
    ],
    "model_name": "MHIM"
}
2023-11-28 20:28:17.050 | INFO     | crslab.data.dataset.hredial.hredial:_load_raw_data:104 - [Load train data from /data/xiaoyin/MHIM-main/MHIM/data/dataset/hredial/nltk/train_data.json]
2023-11-28 20:28:18.450 | INFO     | crslab.data.dataset.hredial.hredial:_load_raw_data:107 - [Load valid data from /data/xiaoyin/MHIM-main/MHIM/data/dataset/hredial/nltk/valid_data.json]
2023-11-28 20:28:25.678 | INFO     | crslab.data.dataset.hredial.hredial:_load_raw_data:110 - [Load test data from /data/xiaoyin/MHIM-main/MHIM/data/dataset/hredial/nltk/test_data.json]
2023-11-28 20:28:25.715 | INFO     | crslab.data.dataset.hredial.hredial:_load_vocab:119 - [Load vocab from /data/xiaoyin/MHIM-main/MHIM/data/dataset/hredial/nltk/token2id.json]
2023-11-28 20:28:25.715 | INFO     | crslab.data.dataset.hredial.hredial:_load_vocab:120 - [The size of token2index dictionary is 27297]
2023-11-28 20:28:25.715 | INFO     | crslab.data.dataset.hredial.hredial:_load_vocab:121 - [The size of index2token dictionary is 27297]
2023-11-28 20:28:25.816 | INFO     | crslab.data.dataset.hredial.hredial:_load_other_data:132 - [Load entity dictionary and KG from /data/xiaoyin/MHIM-main/MHIM/data/dataset/hredial/nltk/entity2id.json and /data/xiaoyin/MHIM-main/MHIM/data/dataset/hredial/nltk/dbpedia_subkg.json]
2023-11-28 20:28:25.816 | INFO     | crslab.data.dataset.base:__init__:49 - [Finish data load]
2023-11-28 20:28:54.768 | INFO     | crslab.data.dataset.hredial.hredial:_data_preprocess:177 - [Finish side data process]
2023-11-28 20:28:54.769 | INFO     | crslab.data.dataset.base:__init__:57 - [Finish data preprocess]
2023-11-28 20:28:57.311 | INFO     | crslab.model.crs.mhim.mhim:build_model:152 - [Load Pretrain Weights from pretrain/HReDial/10-epoch.pth]
2023-11-28 20:28:57.724 | INFO     | crslab.model.crs.mhim.mhim:_build_adjacent_matrix:233 - [Adjacent Matrix built.]
2023-11-28 20:28:58.674 | INFO     | crslab.model:get_model:27 - [Build model MHIM]
2023-11-28 20:28:58.719 | INFO     | crslab.evaluator:get_evaluator:25 - [Build evaluator standard]
2023-11-28 20:28:58.719 | INFO     | crslab.system:get_system:32 - [Build system MHIM]
2023-11-28 20:28:58.924 | INFO     | crslab.system.base:build_optimizer:138 - [Build optimizer: Adam]
2023-11-28 20:28:58.925 | INFO     | crslab.system.mhim:train_recommender:117 - [Recommendation epoch 0]
2023-11-28 20:28:58.925 | INFO     | crslab.system.mhim:train_recommender:118 - [Train]
2023-11-28 20:39:47.752 | INFO     | crslab.evaluator.standard:report:62 - 
    grad norm  rec_loss
        7.847     7.604
2023-11-28 20:39:47.752 | INFO     | crslab.system.mhim:train_recommender:123 - [Valid]
2023-11-28 20:40:13.886 | INFO     | crslab.evaluator.standard:report:62 - 
    hit@1  hit@10  hit@50  mrr@1  mrr@10  mrr@50  ndcg@1  ndcg@10  ndcg@50  rec_loss
   .02961   .1765   .3579 .02961  .06667  .07519  .02961   .09223    .1322     7.346
2023-11-28 20:40:13.886 | INFO     | crslab.system.base:early_stop:249 - [Get new best model]
2023-11-28 20:40:13.886 | INFO     | crslab.system.mhim:train_recommender:117 - [Recommendation epoch 1]
2023-11-28 20:40:13.887 | INFO     | crslab.system.mhim:train_recommender:118 - [Train]
2023-11-28 20:51:07.765 | INFO     | crslab.evaluator.standard:report:62 - 
    grad norm  rec_loss
        6.386     6.412
2023-11-28 20:51:07.765 | INFO     | crslab.system.mhim:train_recommender:123 - [Valid]
2023-11-28 20:51:33.230 | INFO     | crslab.evaluator.standard:report:62 - 
    hit@1  hit@10  hit@50  mrr@1  mrr@10  mrr@50  ndcg@1  ndcg@10  ndcg@50  rec_loss
   .03309   .1974   .3974 .03309   .0748  .08425  .03309    .1034    .1475     7.159
2023-11-28 20:51:33.230 | INFO     | crslab.system.base:early_stop:249 - [Get new best model]
2023-11-28 20:51:33.230 | INFO     | crslab.system.mhim:train_recommender:117 - [Recommendation epoch 2]
2023-11-28 20:51:33.231 | INFO     | crslab.system.mhim:train_recommender:118 - [Train]
2023-11-28 21:09:57.045 | INFO     | crslab.evaluator.standard:report:62 - 
    grad norm  rec_loss
        6.333     5.953
2023-11-28 21:09:57.045 | INFO     | crslab.system.mhim:train_recommender:123 - [Valid]
2023-11-28 21:12:48.531 | INFO     | crslab.evaluator.standard:report:62 - 
    hit@1  hit@10  hit@50  mrr@1  mrr@10  mrr@50  ndcg@1  ndcg@10  ndcg@50  rec_loss
   .03251   .2102   .4122 .03251  .07583  .08541  .03251    .1070    .1517     7.135
2023-11-28 21:12:48.531 | INFO     | crslab.system.base:early_stop:249 - [Get new best model]
2023-11-28 21:12:48.531 | INFO     | crslab.system.mhim:train_recommender:117 - [Recommendation epoch 3]
2023-11-28 21:12:48.531 | INFO     | crslab.system.mhim:train_recommender:118 - [Train]
2023-11-28 21:50:46.959 | INFO     | crslab.evaluator.standard:report:62 - 
    grad norm  rec_loss
        6.346     5.626
2023-11-28 21:50:46.968 | INFO     | crslab.system.mhim:train_recommender:123 - [Valid]
2023-11-28 21:53:22.422 | INFO     | crslab.evaluator.standard:report:62 - 
    hit@1  hit@10  hit@50  mrr@1  mrr@10  mrr@50  ndcg@1  ndcg@10  ndcg@50  rec_loss
   .03222   .2154   .4119 .03222  .07718  .08663  .03222    .1093    .1529     7.197
2023-11-28 21:53:22.423 | INFO     | crslab.system.mhim:train_recommender:117 - [Recommendation epoch 4]
2023-11-28 21:53:22.423 | INFO     | crslab.system.mhim:train_recommender:118 - [Train]
2023-11-28 22:30:58.820 | INFO     | crslab.evaluator.standard:report:62 - 
    grad norm  rec_loss
        6.314     5.381
2023-11-28 22:30:58.840 | INFO     | crslab.system.mhim:train_recommender:123 - [Valid]
2023-11-28 22:33:59.428 | INFO     | crslab.evaluator.standard:report:62 - 
    hit@1  hit@10  hit@50  mrr@1  mrr@10  mrr@50  ndcg@1  ndcg@10  ndcg@50  rec_loss
   .03628   .2052   .4165 .03628  .07806  .08817  .03628    .1077    .1545     7.322
2023-11-28 22:33:59.429 | INFO     | crslab.system.base:early_stop:254 - [Early stop]
2023-11-28 22:33:59.429 | INFO     | crslab.system.mhim:train_recommender:134 - [Test]
2023-11-28 22:37:19.132 | INFO     | crslab.evaluator.standard:report:62 - 
    hit@1  hit@10  hit@50  mrr@1  mrr@10  mrr@50  ndcg@1  ndcg@10  ndcg@50  rec_loss
    .0282   .1920   .3789  .0282  .06986  .07887   .0282   .09839    .1399     7.331
2023-11-28 22:37:19.134 | INFO     | crslab.system.base:build_optimizer:138 - [Build optimizer: Adam]
2023-11-28 22:37:19.134 | INFO     | crslab.system.base:build_lr_scheduler:155 - [Build scheduler ReduceLROnPlateau]
2023-11-28 22:37:19.135 | INFO     | crslab.system.mhim:train_conversation:151 - [Conversation epoch 0]
2023-11-28 22:37:19.135 | INFO     | crslab.system.mhim:train_conversation:152 - [Train]
2023-11-29 00:06:49.854 | INFO     | crslab.evaluator.standard:report:62 - 
    gen_loss  grad clip ratio  grad norm   ppl
       4.396                1      4.924 81.13
2023-11-29 00:06:49.884 | INFO     | crslab.system.mhim:train_conversation:157 - [Valid]
2023-11-29 00:14:56.796 | INFO     | crslab.evaluator.standard:report:62 - 
    bleu@1  bleu@2  bleu@3  bleu@4  dist@1  dist@2  dist@3  dist@4    f1  gen_loss   ppl
     .2833  .06721  .02838  .01717  .05838   .8501   3.431   6.672 .3511     3.881 48.46
2023-11-29 00:14:56.803 | INFO     | crslab.system.mhim:train_conversation:151 - [Conversation epoch 1]
2023-11-29 00:14:56.803 | INFO     | crslab.system.mhim:train_conversation:152 - [Train]
2023-11-29 01:37:38.745 | INFO     | crslab.evaluator.standard:report:62 - 
    gen_loss  grad clip ratio  grad norm   ppl
       3.506                1      2.706 33.31
2023-11-29 01:37:38.763 | INFO     | crslab.system.mhim:train_conversation:157 - [Valid]
2023-11-29 01:45:23.271 | INFO     | crslab.evaluator.standard:report:62 - 
    bleu@1  bleu@2  bleu@3  bleu@4  dist@1  dist@2  dist@3  dist@4    f1  gen_loss   ppl
     .2881  .07179  .02746  .01408   .1094   1.215   4.212   7.553 .3583     3.688 39.96
2023-11-29 01:45:23.278 | INFO     | crslab.system.mhim:train_conversation:151 - [Conversation epoch 2]
2023-11-29 01:45:23.279 | INFO     | crslab.system.mhim:train_conversation:152 - [Train]
2023-11-29 03:04:03.896 | INFO     | crslab.evaluator.standard:report:62 - 
    gen_loss  grad clip ratio  grad norm   ppl
       3.188                1      2.345 24.24
2023-11-29 03:04:03.896 | INFO     | crslab.system.mhim:train_conversation:157 - [Valid]
2023-11-29 03:11:48.962 | INFO     | crslab.evaluator.standard:report:62 - 
    bleu@1  bleu@2  bleu@3  bleu@4  dist@1  dist@2  dist@3  dist@4    f1  gen_loss  ppl
     .2862  .07775  .02993  .01668   .2079   1.729   5.154   8.692 .3588     3.646 38.3
2023-11-29 03:11:48.971 | INFO     | crslab.system.mhim:train_conversation:151 - [Conversation epoch 3]
2023-11-29 03:11:48.971 | INFO     | crslab.system.mhim:train_conversation:152 - [Train]
2023-11-29 04:31:03.589 | INFO     | crslab.evaluator.standard:report:62 - 
    gen_loss  grad clip ratio  grad norm   ppl
       2.961                1      2.154 19.33
2023-11-29 04:31:03.590 | INFO     | crslab.system.mhim:train_conversation:157 - [Valid]
2023-11-29 04:38:48.305 | INFO     | crslab.evaluator.standard:report:62 - 
    bleu@1  bleu@2  bleu@3  bleu@4  dist@1  dist@2  dist@3  dist@4    f1  gen_loss   ppl
     .3061  .08542  .03544  .01925   .2370   1.785   5.117   8.587 .3728     3.659 38.81
2023-11-29 04:38:48.312 | INFO     | crslab.system.mhim:train_conversation:151 - [Conversation epoch 4]
2023-11-29 04:38:48.312 | INFO     | crslab.system.mhim:train_conversation:152 - [Train]
2023-11-29 05:59:08.236 | INFO     | crslab.evaluator.standard:report:62 - 
    gen_loss  grad clip ratio  grad norm   ppl
       2.799                1      2.096 16.43
2023-11-29 05:59:08.236 | INFO     | crslab.system.mhim:train_conversation:157 - [Valid]
2023-11-29 06:07:12.266 | INFO     | crslab.evaluator.standard:report:62 - 
    bleu@1  bleu@2  bleu@3  bleu@4  dist@1  dist@2  dist@3  dist@4    f1  gen_loss   ppl
     .3123  .08638  .03453  .01915   .3235   2.346   6.394   10.65 .3759     3.664 39.03
2023-11-29 06:07:12.266 | INFO     | crslab.system.mhim:train_conversation:168 - [Test]
2023-11-29 06:18:01.285 | INFO     | crslab.evaluator.standard:report:62 - 
    bleu@1  bleu@2  bleu@3  bleu@4  dist@1  dist@2  dist@3  dist@4    f1
     .1782  .03569  .01474 .008486   .1174   .4003   .7404   1.123 .2339
